<!DOCTYPE html>
<html ng-app="vidamo" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width">
  <title>UI.Layout : angular UI version</title>

  <!-- stylesheet -->
  <link rel="stylesheet" href="css/vidamo-layout.css">
  <link rel="stylesheet" href="css/ui-layout.css">
  <link rel="stylesheet" href="css/bootstrap/bootstrap.css">
  <link rel="stylesheet" href="css/select2.css">
  <link rel="stylesheet" href="css/ui-tree.css">
  <link rel="stylesheet" href="js/threejs/editor/css/types.css" >
  <link rel="stylesheet" href="css/light.css" id="theme">
  <link rel="stylesheet" href="css/graph.css">
  <link rel="stylesheet" href="css/panzoomwidget.css">

  <style type="text/css">

  </style>

  <!--three.js-->
    <script src="js/threejs/build/three.min.js"></script>
    <script src="js/threejs/examples/js/libs/system.min.js"></script>
    <script src="js/threejs/examples/js/controls/EditorControls.js"></script>
    <script src="js/threejs/examples/js/controls/TransformControls.js"></script>
    <script src="js/threejs/examples/js/loaders/BabylonLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/ColladaLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/OBJLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/PLYLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/STLLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/UTF8Loader.js"></script>
    <script src="js/threejs/examples/js/loaders/VRMLLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/VTKLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/ctm/lzma.js"></script>
    <script src="js/threejs/examples/js/loaders/ctm/ctm.js"></script>
    <script src="js/threejs/examples/js/loaders/ctm/CTMLoader.js"></script>
    <script src="js/threejs/examples/js/exporters/SceneExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/OBJExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/STLExporter.js"></script>
    <script src="js/threejs/examples/js/renderers/RaytracingRenderer.js"></script>
    <script src="js/threejs/examples/js/renderers/SoftwareRenderer.js"></script>
    <script src="js/threejs/examples/js/renderers/SVGRenderer.js"></script>

    <script src="js/threejs/examples/js/BufferGeometryUtils.js"></script>
    <script src="js/threejs/examples/js/exporters/BufferGeometryExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/TypedGeometryExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/GeometryExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/MaterialExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/ObjectExporter.js"></script>
    <script src="js/threejs/examples/js/renderers/WebGLRenderer3.js"></script>

    <script src="js/threejs/editor/js/libs/signals.min.js"></script>
    <script src="js/threejs/editor/js/libs/ui.js"></script>
    <script src="js/threejs/editor/js/libs/ui.editor.js"></script>
    <script src="js/threejs/editor/js/libs/ui.three.js"></script>

    <script src="js/threejs/editor/js/Storage.js"></script>
    <script src="js/threejs/editor/js/Editor.js"></script>
    <script src="js/threejs/editor/js/Config.js"></script>
    <script src="js/threejs/editor/js/Loader.js"></script>
    <script src="js/threejs/editor/js/Viewport.js"></script>

    <script src="js/threejs/add.js"></script>

</head>

<body>
    <!--dropdown Menu-->
    <div>
        <span class="dropdown" on-toggle="toggled(open)">
          <a href class="dropdown-toggle">  File |</a>
          <ul class="dropdown-menu">
          <li><a onclick="onNewOptionClick ()"> New </a></li>
            <li><a href="#"> Open</a></li>
            <li><a href="#"> Save </a></li>
            <li class="divider"></li>
            <li><a href="#"> Exit </a></li>
          </ul>
        </span>

        <span class="dropdown" on-toggle="toggled(open)" >
          <a href class="dropdown-toggle">  Edit |</a>
        </span>

        <span class="dropdown" on-toggle="toggled(open)" >
          <a href class="dropdown-toggle">  View |</a>
        </span>

        <span class="dropdown" on-toggle="toggled(open)" >
          <a href class="dropdown-toggle">  Libraries |</a>
        </span>

        <span class="dropdown" on-toggle="toggled(open)" >
          <a href class="dropdown-toggle">  Setting |</a>
        </span>

        <span class="dropdown" on-toggle="toggled(open)" >
          <a href class="dropdown-toggle">  Help |</a>
        </span>
    </div>

        <div  ng-controller="graphCtrl">
            <!--resizable layout-->
            <div ui-layout>
                <div ui-layout="{flow : 'column'}" >
                    <!--graph area-->
                    <tabset justified="true" class=" graph-area">
                        <tab heading="nodes">
                            <div
                                 mouse-capture
                                 ng-keydown="keyDown($event)"
                                 ng-keyup="keyUp($event)">

                                <div ng-controller="znpController" class="znpController">
                                    <div>
                                        <panzoom config="panzoomConfig"
                                                 model="panzoomModel"
                                                 class="panzoom">
                                            <div>
                                                <flow-chart chart="chartViewModel" class = "flow-chart" >
                                                </flow-chart>
                                            </div>
                                        </panzoom>
                                    </div>
                                </div>

                                <div class = "buttons">
                                <button class="btn btn-xs"
                                        ng-click="addNewNode()"
                                        title="Add a new node to the chart">
                                    Add Node
                                </button> &nbsp;&nbsp;
                                <button class="btn btn-xs"
                                        ng-click="addNewInputConnector()"
                                        ng-disabled="chartViewModel.getSelectedNodes().length == 0"
                                        title="Add a new input connector to the selected node">
                                    Add Input
                                </button> &nbsp;&nbsp;
                                <button class="btn btn-xs"
                                        ng-click="addNewOutputConnector()"
                                        ng-disabled="chartViewModel.getSelectedNodes().length == 0"
                                        title="Add a new output connector to the selected node">
                                    Add Output
                                </button> &nbsp;&nbsp;
                                <button class="btn btn-xs"
                                        ng-click="deleteSelected()"
                                        ng-disabled="chartViewModel.getSelectedNodes().length
                                            == 0 && chartViewModel.getSelectedConnections().length == 0"
                                        title="Delete selected nodes and connections">
                                    Delete
                                </button> &nbsp;&nbsp;
                                <button class="btn btn-xs"
                                        ng-click="run()"
                                        title="Run program">
                                    Run
                                </button>
                                </div>
                            </div>
                      </tab>
                      <tab heading = "Node Code">
                          <div class="codeEditor"
                               ui-ace="{ mode: 'javascript', theme: 'monokai' }"
                               ng-model="javascriptCode"></div>
                      </tab>
                  </tabset>

                <!--3D view area  -->
                    <div class=" view-area" >
                        <tabset justified ="true">
                            <tab heading="3D View">
                                <div class="Panel" id ="viewport" >
                                    <script>
                                        var editor = new Editor();

                                        var viewport = new Viewport( editor ).setId( 'viewport' );
                                        document.getElementById("viewport").appendChild(viewport.dom);

                                        editor.setTheme( editor.config.getKey( 'theme' ) );

                                        editor.storage.init( function () {

                                            var timeout;
                                            var exporter = new THREE.ObjectExporter();
                                            var saveState = function ( scene ) {
                                                clearTimeout( timeout );
                                                timeout = setTimeout( function () {
                                                    editor.storage.set( exporter.parse( editor.scene ) );
                                                }, 1000 );

                                            };

                                            var signals = editor.signals;

                                            signals.objectAdded.add( saveState );
                                            signals.objectChanged.add( saveState );
                                            signals.objectRemoved.add( saveState );
                                            signals.materialChanged.add( saveState );
                                            signals.sceneGraphChanged.add( saveState );
                                        } );

                                        document.addEventListener( 'dragover', function ( event ) {
                                            event.preventDefault();
                                            event.dataTransfer.dropEffect = 'copy';
                                        }, false );

                                        document.addEventListener( 'drop', function ( event ) {
                                            event.preventDefault();
                                            editor.loader.loadFile( event.dataTransfer.files[ 0 ] );
                                        }, false );

                                        document.addEventListener( 'keydown', function ( event ) {
                                            switch ( event.keyCode ) {
                                                case 8: // prevent browser back
                                                    event.preventDefault();
                                                    break;
                                                case 46: // delete
                                                    var parent = editor.selected.parent;
                                                    editor.removeObject( editor.selected );
                                                    editor.select( parent );
                                                    break;
                                            }
                                        }, false );

                                        var onWindowResize = function ( event ) {
                                            editor.signals.windowResize.dispatch();
                                        };
                                        window.addEventListener( 'resize', onWindowResize, false );
                                        onWindowResize();
                                    </script>
                              </div>
                            </tab>
                            <tab heading = "Console"></tab>
                        </tabset>
                    </div>


                <!--code area-->
                <div class=" code-area" >
                    <tabset class="tabArea">
                        <tab heading="Procedure" >
                            <div>
                                <div>
                                    <script type="text/ng-template" id="nodes_renderer.html">
                                        <div ui-tree-handle class="tree-node tree-node-content">
                                            <accordion close-others= "true" >
                                                <div class="panelHack">
                                                    <accordion-group is-open="true">
                                                        <accordion-heading>
                                                            <a ng-if="node.nodes && node.nodes.length > 0
                                                            || node.nodes && node.nodes.length == 0"
                                                               data-nodrag ng-click="toggle(this)">
                                                                  <span class="glyphicon"
                                                                        ng-class=
                                                                                "{'glyphicon-chevron-right': collapsed,
                                                                                 'glyphicon-chevron-down': !collapsed}">
                                                                  </span>
                                                            </a>
                                                            {{node.title}}
                                                            <a class="pull-right btn btn-xs"
                                                               data-nodrag ng-click="remove(this)">
                                                                <span class="glyphicon glyphicon-remove">
                                                                </span>
                                                            </a>
                                                        </accordion-heading>

                                                        <div ui-tree-nodes=""
                                                             ng-model="node.nodes"
                                                             ng-class="{hidden: collapsed}">

                                                            <!--data name and value for data -->
                                                            <div ng-if="node.title == 'Data'">
                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon">data name</span>
                                                                    <input class="form-control"
                                                                           name="dataName"
                                                                           placeholder="{{node.dataName}}"
                                                                           ng-model="dataName"
                                                                           ng-change=
                                                                               "applyValue('dataName',this.dataName,node)">
                                                                </div>
                                                                </br>
                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon" >data value</span>
                                                                    <input class="form-control"
                                                                           name="dataValue"
                                                                           placeholder="{{node.dataValue}}"
                                                                           ng-model="dataValue"
                                                                           ng-change=
                                                                               "applyValue('dataValue',this.dataValue,node)">
                                                                </div>
                                                            </div>

                                                            <!-- looping for Control-->
                                                            <div ng-if="node.title == 'Control'">
                                                                <div class="input-group">
                                                                    <span class="input-group-addon">Looping</span>
                                                                    <input type="number"
                                                                           class="form-control"
                                                                           placeholder="num of loops"
                                                                           name ="looping"
                                                                           ng-model="looping"
                                                                           ng-change="applyValue('looping',this.looping)">
                                                                </div>
                                                                </br>
                                                            </div>

                                                            <!--dropdown menu for Action-->
                                                            <div ng-if="node.title == 'Action'">
                                                                <span> method: </span>
                                                                <select ng-model="method"
                                                                        name ="method"
                                                                        ng-change="applyValue('method',this.method,node)"
                                                                        style="width: 200px;">
                                                                    <option value="" selected disabled>
                                                                        {{node.method}}
                                                                    </option>
                                                                    <option value="print data">print data</option>
                                                                    <option value="get input">get input </option>
                                                                    <option value="append output">append output</option>
                                                                </select></br></br>
                                                            </div>

                                                            <!--method for append data to output port-->
                                                            <div ng-if="node.method == 'append output'">
                                                                <span> output port: </span>
                                                                <select ng-model="outputPort"
                                                                        ng-change =
                                                                            "applyValue('outputPort', this.outputPort,node)"
                                                                        style="width: 200px;">
                                                                    <option value="" selected disabled>
                                                                        {{node.parameters[0]}}
                                                                    </option>
                                                                    <option  ng-repeat=
                                                                             "outputPort in node.parentNode.data.outputConnectors"
                                                                             value="{{outputPort.name}}">
                                                                        {{outputPort.name}}
                                                                    </option>
                                                                </select></br></br>

                                                                <span> data name: </span>
                                                                <select ng-model="outputDataName"
                                                                        style="width: 200px;"
                                                                        ng-change =
                                                                            "applyValue('outputDataName', this.outputDataName,node)"
                                                                        style="width: 200px;">
                                                                    <option value=""
                                                                            selected disabled>
                                                                        {{node.parameters[2]}}
                                                                    </option>
                                                                    <option ng-repeat="node in data"
                                                                            value="{{node.dataValue}},{{node.dataName}}">
                                                                        {{node.dataName}}
                                                                    </option>
                                                                </select></br></br>
                                                            </div>

                                                            <!--method for get data from input port-->
                                                            <div ng-if="node.method == 'get input'">
                                                                <span> output port: </span>
                                                                <select ng-model="inputPort"
                                                                        ng-change =
                                                                                "applyValue('inputPort', this.inputPort,node)"
                                                                        style="width: 200px;">
                                                                    <option value="" selected disabled>
                                                                        {{node.parameters[0]}}
                                                                    </option>
                                                                    <option  ng-repeat="inputPort in node.parentNode.data.inputConnectors"
                                                                             value="{{inputPort.name}}">
                                                                        {{inputPort.name}}
                                                                    </option>
                                                                </select></br></br>

                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon">data name</span>
                                                                    <input class="form-control"
                                                                           name="dataName"
                                                                           placeholder="{{node.dataName}}"
                                                                           ng-model="dataName"
                                                                           ng-change=
                                                                                   "applyValue('dataName',this.dataName,node)">
                                                                </div>
                                                            </div>

                                                            <div ng-repeat="node in node.nodes"
                                                                 ui-tree-node ng-include="'nodes_renderer.html'">
                                                            </div>
                                                        </div>
                                                    </accordion-group>
                                                </div>
                                            </accordion>
                                        </div>
                                    </script>

                                    <div ui-tree id="tree-root">
                                        <div ui-tree-nodes="" ng-model="data">
                                            <div ng-repeat="node in data"
                                                 ui-tree-node ng-include="'nodes_renderer.html'">
                                            </div>
                                        </div>
                                    </div>
                                    </div>

                                    <div class = "buttons">
                                        <br>
                                        <button class="btn btn-xs" ng-click="newItem('Data')">Add Data</button>
                                        &nbsp;&nbsp;&nbsp;
                                        <button class="btn btn-xs" ng-click="newItem('Action')">Add Action</button>
                                        &nbsp;&nbsp;&nbsp;
                                        <button class="btn btn-xs" ng-click="newItem('Control')">Add Control</button>
                                        &nbsp;&nbsp;&nbsp;
                                    </div>
                                </div>

                        </tab>

                        <tab heading="Interface"></tab>
                        <!--ace text editor-->
                        <tab heading="Procedure Code">
                            <div class="codeEditor" ui-ace="{ mode: 'javascript', theme: 'monokai' }"
                                 ng-model="functionCode">
                            </div>
                        </tab>

                    </tabset>
                </div>

              </div>
            </div>
    </div>

         <!--  javascript -->
         <!--jquery-->
         <script type="text/javascript" src="js/jquery/jquery-1.11.1.js"></script>
         <!--angular modules -->
         <script type="application/javascript" src="js/angular/angular.min.js"></script>
         <script type="text/javascript" src="js/angular/angular-sanitize.js"></script>
         <!--angular-ui packages-->
         <script type="text/javascript" src="js/angular-ui/ui-ace/ui-ace.js"></script>
         <script type="application/javascript" src="js/angular-ui/ui-layout/ui-layout.js"></script>
         <script src="js/angular-ui/ui-bootstrap/ui-bootstrap-tpls-0.11.0.min.js"></script>
         <script type="text/javascript" src="js/angular-ui/ui-tree/angular-ui-tree.js"></script>
         <!--supporting packages-->
         <script type="text/javascript" src="js/packages/select2-3.5.0/select2.js"></script>
         <script type="text/javascript" src="js/packages/ace-builds/src-min-noconflict/ace.js"></script>
         <!--flowchart system-->
         <script src="js/angular-ui/ui-flowchart/debug.js" type="text/javascript"></script>
         <script src="js/angular-ui/ui-flowchart/svg_class.js" type="text/javascript"></script>
         <script src="js/angular-ui/ui-flowchart/mouse_capture_service.js" type="text/javascript"></script>
         <script src="js/angular-ui/ui-flowchart/dragging_service.js" type="text/javascript"></script>
         <script src="js/angular-ui/ui-flowchart/flowchart_viewmodel.js" type="text/javascript"></script>
         <script src="js/angular-ui/ui-flowchart/flowchart_directive.js" type="text/javascript"></script>
          <!-- zoom and pan-->
         <script src="js/packages/hamsterjs/hamster.js"></script>
         <script src="js/angular/angular-mousewheel/mousewheel.js"></script>
         <script src="js/angular-ui/ui-panzoom/panzoom.0.1-snapshot.js"></script>
         <!--vidamo angular app-->
         <script src="js/client/vidamo.js"></script>

</body>

</html>